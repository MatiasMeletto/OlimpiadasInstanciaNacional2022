@inject NavigationManager navigationManager
@inject IDbContextFactory<CodeBluingDbContext> DbFactory
@page "/zonasAreas/inspZona/{ZonaId:int?}"

<h1 class="text-center">Zona Nº @ZonaId</h1>

<br>
<h4 class="text-decoration-underline">@zona.Nombre</h4>
<br>
<div class="container-fluid">
	<div class="row container">
		@if(pacientes is not null)
		{
		<div class="col-4">	
			<div class="EstiloTabla container">
				<table id="tabla1">
					<thead>
						<tr>
							<th>Pacientes</th>
						</tr>
					</thead>
					<tbody>

						@foreach (Paciente p in pacientes)
						{
							<tr>
								<td>@p.Nombre  @p.Apellido</td>			
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
		}

		@if(personal is not null)
		{
		<div class="col-4">	
			<div class="EstiloTabla container">
				<table id="tabla1">
					<thead>
						<tr>
							<th>Personal</th>
						</tr>
					</thead>
					<tbody>

						@foreach (PersonalMedico p in personal)
						{
							<tr>
								<td>@p.Nombre  @p.Apellido</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>	
		}


		@if(llamados is not null)
		{
		<div class="col-4">	
			<div class="EstiloTabla container">
				<table id="tabla1">
					<thead>
						<tr>
							<th>Llamado</th>
						</tr>
					</thead>
					<tbody>

						@foreach (Llamado l in llamados)
						{
							<tr>
								<td>@l.TipoLlamado @l.Atendido @l.Paciente.Apellido</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
		}
	</div>
</div>
<br >
<br >
<br >
<button @onclick="@(() => { navigationManager.NavigateTo("/zonasAreas"); })"> Volver </button>

@code {
	[Parameter]
	public int? ZonaId { get; set; }

	public class ZonaViewModel
	{
		public string Nombre { get; set; }
	}

	public ZonaViewModel zona { get; set; } = new();
	public Paciente[]? pacientes { get; set; }
	public Llamado[]? llamados { get; set; }
	public PersonalMedico[]? personal { get; set; }

	protected override async Task OnInitializedAsync()
	{
		using var db = DbFactory.CreateDbContext();

		pacientes = await db.Pacientes.Where(p => p.ZonaId == ZonaId).ToArrayAsync();
		llamados = await db.Llamados.Where(p => p.ZonaId == ZonaId).ToArrayAsync();
		personal = await db.Personal.Where(p => p.ZonaId == ZonaId).ToArrayAsync();

		Zona? z = await db.Zonas.Where(z => z.ZonaId == ZonaId).SingleOrDefaultAsync();

		if (z is not null)
		{
			zona.Nombre = z.Nombre;
		}
	}
}